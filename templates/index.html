{%- extends "frame.html" -%}
{%- block title -%}
    * {{ title }} - {{ site_name }}
{%- endblock -%}
{%- block extra_js_link -%}
    <script type="text/javascript" src="{{ get_static_file_url("js/index.js") }}"></script>
{%- endblock -%}
{%- block extra_css_link -%}
    <link rel="stylesheet" type="text/css" href="{{ get_static_file_url("css/index.css") }}">
{%- endblock -%}
{%- block content -%}
    <h1>{{ title }}</h1>
    <vue-return-home></vue-return-home>
    <hr>
    <div style="height: 30px;">
        <div class="search-input-group">
            <input id="idS" placeholder="Search ID">
            <input id="titleS" placeholder="Search Title">
            <input id="tagS" placeholder="Search Tag">
            <input id="dateS" placeholder="Search Date">
        </div>
        <div class="button-group">
            <button id="search" class="button icon search">Search</button>
            <button id="clean" class="button danger icon trash">Clean</button>
        </div>
    </div>
    <div class="markdown-body">
        {%- set parents = data[0] -%}
        {%- set attachments = data[1] -%}
        {%- set ignore_files = data[2] -%}
        <div class="tab">
            {%- if parents[''] -%}
                <vue-index-tab-button name="{{ article_url }}" id="defaultOpen"></vue-index-tab-button>
            {%- endif -%}
            {%- for parent in parents | sort -%}
                {%- if not parent -%}
                    {%- continue -%}
                {%- endif -%}
                <vue-index-tab-button name="{{ parent }}"
                                      id="{{ "defaultOpen" if not parents[''] and loop.index == 1 else "" }}">
                </vue-index-tab-button>
            {%- endfor -%}
            {%- if attachments -%}
                <vue-index-tab-button name="{{ attach_url }}" id="defaultOpen"></vue-index-tab-button>
            {%- endif -%}
            {%- if ignore_files -%}
                <vue-index-tab-button name="{{ ignore_tab_name }}"></vue-index-tab-button>
            {%- endif -%}
        </div>
        {%- for parent in parents -%}
            <div id="{{ parent if parent else article_url }}" class="tabcontent">
                <table>
                    <thead>
                    <tr>
                        <th width="20">ID</th>
                        <th>Title</th>
                        <th>Tags</th>
                        <th width="155">Date</th>
                        <th width="80">Fixed</th>
                        <th width="80">Top</th>
                        <th width="80">Highlight</th>
                        <th width="80">NoTags</th>
                        <th width="100">Edit</th>
                    </tr>
                    </thead>
                    <tbody>
                    {%- for article in parents[parent] -%}
                        {%- set isFixed = article[index_fixed_key] -%}
                        {%- set isTop = article[index_top_key] -%}
                        {%- set isHighlight = article[index_highlight_key] -%}
                        {%- set isNotags = article[index_notags_key] -%}
                        {%- set article_path = article[index_path_key] -%}
                        <tr>
                            <td align="right">{{ article[index_id_key] }}</td>
                            <td><a href="{{ article[index_url_key] }}">{{ article[index_title_key] }}</a></td>
                            <td>
                                {%- for key in article[index_tags_key] | sort -%}
                                    <vue-tag url="{{ "?t=" + article[index_tags_key][key] }}"
                                             name="{{ article[index_tags_key][key] }}">
                                    </vue-tag>
                                {%- endfor -%}
                            </td>
                            <td>
                                <div style="display: inline">{{ article[index_date_key] }}</div>
                                <div class="button-group edit-group">
                                    <button class="button" title="Edit Date" onclick="edit(this, 'date')">E</button>
                                    <button class="button" title="Submit"
                                            onclick="submit(this, '{{ url_for("edit.date", item_path=article_path) }}')"
                                            style="display: none">S
                                    </button>
                                    <button class="button" title="Cancel" onclick="cancel(this)"
                                            style="display: none">C
                                    </button>
                                </div>
                            </td>
                            <td align="center">
                                <vue-check :checked="{{ isFixed | lower }}"></vue-check>
                                <div class="button-group edit-group">
                                    {%- set fixed_urls = [url_for("edit.fixed", item_path=article_path), url_for("edit.unfixed", item_path=article_path)] -%}
                                    <button class="button" title="Toggle"
                                            onclick='toggle(this, {{ fixed_urls | tojson }}, {{ isFixed | lower }})'>T
                                    </button>
                                </div>
                            </td>
                            <td align="center">
                                <vue-check :checked="{{ isTop | lower }}"></vue-check>
                                <div class="button-group edit-group">
                                    {%- set top_urls = [url_for("edit.top", item_path=article_path), url_for("edit.untop", item_path=article_path)] -%}
                                    <button class="button" title="Toggle"
                                            onclick='toggle(this, {{ top_urls | tojson }}, {{ isTop | lower }})'>T
                                    </button>
                                </div>
                            </td>
                            <td align="center">
                                <vue-check :checked="{{ isHighlight | lower }}"></vue-check>
                                <div class="button-group edit-group">
                                    {%- set hl_urls = [url_for("edit.highlight", item_path=article_path), url_for("edit.unhighlight", item_path=article_path)] -%}
                                    <button class="button" title="Toggle"
                                            onclick='toggle(this, {{ hl_urls | tojson }}, {{ isHighlight | lower }})'>T
                                    </button>
                                </div>
                            </td>
                            <td align="center">
                                <vue-check :checked="{{ isNotags | lower }}"></vue-check>
                                <div class="button-group edit-group">
                                    {%- set notags_urls = [url_for("edit.notags", item_path=article_path), url_for("edit.unnotags", item_path=article_path)] -%}
                                    <button class="button" title="Toggle"
                                            onclick='toggle(this, {{ notags_urls | tojson }}, {{ isNotags | lower }})'>T
                                    </button>
                                </div>
                            </td>
                            <td>
                                <div class="button-group edit-group">
                                    <a href="{{ url_for("edit.ignore", item_path=article_path) }}"
                                       class="button danger" title="Ignore">I
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {%- endfor -%}
                    </tbody>
                </table>
            </div>
        {%- endfor -%}
        {%- if attachments -%}
            {%- set attch_len = attachments | length -%}
            {%- set max_rows = 10 -%}
            {%- set max_column = (attch_len / max_rows) | round(0, 'ceil') | int -%}
            <div id="{{ attach_url }}" class="tabcontent">
                <table>
                    <tbody>
                    {%- for i in range(attch_len if attch_len < max_rows else max_rows) -%}
                        <tr>
                            {%- for j in range(max_column) -%}
                                {%- set index = j * max_rows + i -%}
                                {%- if index < attch_len -%}
                                    {%- set attachment = attachments[index] -%}
                                    <td align="right" width="20">{{ attachment[index_id_key] }}</td>
                                    <td>
                                        <a href="{{ attachment[index_url_key] }}">{{ attachment[index_title_key] }}</a>
                                    </td>
                                {%- endif -%}
                            {%- endfor -%}
                        </tr>
                    {%- endfor -%}
                    </tbody>
                </table>
            </div>
        {%- endif -%}
        {%- if ignore_files -%}
            <div id="{{ ignore_tab_name }}" class="tabcontent">
                <table>
                    <thead>
                    <tr>
                        <th>Path</th>
                        <th width="250">Edit</th>
                    </tr>
                    </thead>
                    <tbody>
                    {%- for file_name in ignore_files -%}
                        <tr>
                            <td>{{ file_name }}</td>
                            <td>
                                <div class="button-group edit-group">
                                    <a href="{{ url_for("edit.unignore", item_path=file_name) }}"
                                       class="button" title="UnIgnore">UI
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {%- endfor -%}
                    </tbody>
                </table>
            </div>
        {%- endif -%}
    </div>
{%- endblock -%}
