{% extends "frame.html" %}
{% block title %}
    {{ title }}
{% endblock %}
{% block extra_style %}
    #idS, #titleS, #tagS, #dateS {
    height: 22px;
    width: 100px;
    padding-left: 5px;
    padding-right: 5px;
    }

    #body {
    max-width: 9999px;
    margin: 0;
    }
{% endblock %}
{% block content %}
    <h1>{{ title }}</h1>
    <a href="{{ url_for('main.index') }}"><i class="fas fa-angle-double-left"></i> HOME</a>
    <hr>
    <input id="idS" placeholder="Search ID" onkeydown="if(event.keyCode===13){search.click()}">
    <input id="titleS" placeholder="Search Title" onkeydown="if(event.keyCode===13){search.click()}">
    <input id="tagS" placeholder="Search Tag" onkeydown="if(event.keyCode===13){search.click()}">
    <input id="dateS" placeholder="Search Date" onkeydown="if(event.keyCode===13){search.click()}">
    <button id="search"><i class="fa fa-search"></i> Search</button>
    <button id="clean"><i class="fa fa-trash"></i> Clean</button>
    <script>
        $(document).ready(function () {
            function GetRequest() {
                var url = location.search;
                var request = {};
                if (url.indexOf("?") !== -1) {
                    var str = url.substr(1);
                    var strList = str.split("&");
                    for (var i = 0; i < strList.length; i++) {
                        request[strList[i].split("=")[0]] = decodeURI(strList[i].split("=")[1]);
                    }
                }
                return request;
            }

            var id = $("#idS");
            var title = $("#titleS");
            var tag = $("#tagS");
            var date = $("#dateS");

            var request = GetRequest();
            id.val(request["i"]);
            title.val(request["n"]);
            tag.val(request["t"]);
            date.val(request["d"]);

            $("#search").click(function () {
                var idVal = $.trim(id.val());
                var nameVal = $.trim(title.val());
                var tagVal = $.trim(tag.val());
                var dateVal = $.trim(date.val());
                var href = "";
                if (idVal !== "") {
                    href += "&i=" + idVal
                }
                if (nameVal !== "") {
                    href += "&n=" + nameVal
                }
                if (tagVal !== "") {
                    href += "&t=" + tagVal
                }
                if (dateVal !== "") {
                    href += "&d=" + dateVal
                }
                if (href !== "") {
                    href = "?" + href.substr(1)
                }
                window.location.href = window.location.pathname + href
            });

            $("#clean").click(function () {
                id.val("");
                title.val("");
                tag.val("");
                date.val("");
            })
        })
    </script>
    <div class="markdown-body">
        {% set articles = data[0] %}
        {% set attachments = data[1] %}
        <table style="height:600px;">
            <thead>
            <tr>
                <th>No.</th>
                <th>Title</th>
                <th>Date</th>
                {% for i in range(max_tag_num) %}
                    <th>Tag-{{ i + 1 }}</th>
                {% endfor %}
            </tr>
            </thead>
            <tbody>
            {% for article in articles %}
                <tr>
                    <td>{{ article[index_id_key] }}</td>
                    <td><a href="{{ article[index_url_key] }}">{{ article[index_title_key] }}</a></td>
                    <td>{{ article[index_date_key] }}</td>
                    {% for tag in article[index_tags_key] | sort %}
                        <td><a href="{{ article[index_tags_key][tag] }}">{{ tag }}</a></td>
                    {% endfor %}
                    {% set remain = max_tag_num - article[index_tags_key]|length %}
                    {% if remain > 0 %}
                        {% for i in range(remain) %}
                            <td></td>
                        {% endfor %}
                    {% endif %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <hr>
        <table>
            <thead>
            <tr>
                <th>No.</th>
                <th>Title</th>
            </tr>
            </thead>
            <tbody>
            {% for attachment in attachments %}
                <tr>
                    <td>{{ attachment[index_id_key] }}</td>
                    <td><a href="{{ attachment[index_url_key] }}">{{ attachment[index_title_key] }}</a></td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}`
