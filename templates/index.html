{%- extends "frame.html" -%}
{%- block title -%}
    {{ title }}
{%- endblock -%}
{%- block extra_js_link -%}
    <script type="text/javascript" src="{{ get_static_file_url("js/index.js") }}"></script>
{%- endblock -%}
{%- block extra_css_link -%}
    <link rel="stylesheet" type="text/css" href="{{ get_static_file_url("css/index.css") }}">
{%- endblock -%}
{%- block content -%}
    <h1>{{ title }}</h1>
    <vue-return-home></vue-return-home>
    <hr>
    <input id="idS" placeholder="Search ID">
    <input id="titleS" placeholder="Search Title">
    <input id="tagS" placeholder="Search Tag">
    <input id="dateS" placeholder="Search Date">
    <button id="search"><i class="fa fa-search"></i> Search</button>
    <button id="clean"><i class="fa fa-trash"></i> Clean</button>
    <div class="markdown-body">
        {%- set parents = data[0] -%}
        {%- set attachments = data[1] -%}
        <div class="tab">
            {%- if parents[''] -%}
                <button class="tablinks" id="defaultOpen">
                    <i style="margin-right: 10px" class="far fa-folder"></i>{{ article_dir }}
                </button>
            {%- endif -%}
            {%- for parent in parents | sort -%}
                {%- if not parent -%}
                    {%- continue -%}
                {%- endif -%}
                <button class="tablinks" {%- if not parents[''] and loop.index ==  1 -%}id="defaultOpen"{%- endif -%}>
                    <i style="margin-right: 10px" class="far fa-folder"></i>{{ parent }}
                </button>
            {%- endfor -%}
            {%- if attachments -%}
                <button class="tablinks" id="defaultOpen">
                    <i style="margin-right: 10px" class="far fa-folder"></i>{{ attach_dir }}
                </button>
            {%- endif -%}
        </div>
        {%- for parent in parents -%}
            <div id="{{ parent if parent else article_dir }}" class="tabcontent">
                <table>
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Date</th>
                        <th>Fixed</th>
                        <th>Top</th>
                        <th>Highlight</th>
                        <th>Secret</th>
                        <th>NoTags</th>
                        <th>Tags</th>
                    </tr>
                    </thead>
                    <tbody>
                    {%- for article in parents[parent] -%}
                        <tr>
                            <td align="right">{{ article[index_id_key] }}</td>
                            <td><a href="{{ article[index_url_key] }}">{{ article[index_title_key] }}</a></td>
                            <td>{{ article[index_date_key] }}</td>
                            <td>{{ article[index_fixed_key] }}</td>
                            <td>{{ article[index_top_key] }}</td>
                            <td>{{ article[index_highlight_key] }}</td>
                            <td>{{ article[index_secret_key] }}</td>
                            <td>{{ article[index_notags_key] }}</td>
                            <td>
                                {%- for key in article[index_tags_key] | sort -%}
                                    <a href="{{ "?t=" + article[index_tags_key][key] }}">
                                        <i style="margin-right: 3px"
                                           class="fas fa-hashtag"></i>{{ article[index_tags_key][key] }}
                                    </a>
                                {%- endfor -%}
                            </td>
                        </tr>
                    {%- endfor -%}
                    </tbody>
                </table>
            </div>
        {%- endfor -%}
        {%- if attachments -%}
            {%- set attch_len = attachments | length -%}
            {%- set max_rows = 10 -%}
            {%- set max_column = (attch_len / max_rows) | round(0, 'ceil') | int -%}
            <div id="{{ attach_dir }}" class="tabcontent">
                <table>
                    <tbody>
                    {%- for i in range(attch_len if attch_len < max_rows else max_rows) -%}
                        <tr>
                            {%- for j in range(max_column) -%}
                                {%- set index = j * max_rows + i -%}
                                {%- if index < attch_len -%}
                                    {%- set attachment = attachments[index] -%}
                                    <td align="right">{{ attachment[index_id_key] }}</td>
                                    <td>
                                        <a href="{{ attachment[index_url_key] }}">{{ attachment[index_title_key] }}</a>
                                    </td>
                                {%- endif -%}
                            {%- endfor -%}
                        </tr>
                    {%- endfor -%}
                    </tbody>
                </table>
            </div>
        {%- endif -%}
    </div>
{%- endblock -%}
